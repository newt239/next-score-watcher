# サーバー保存版ゲーム機能 実装計画

サーバー保存版ゲーム機能（`/online/games`）の未実装部分についてタスク分解と設計方針を記述します。

## 概要

サーバー保存版ゲーム機能は既存のIndexedDBベースのゲーム機能をSQLite（Turso）ベースに移行し、クラウド上でのデータ共有を可能にする機能です。基本的な構造は実装済みですが、以下の機能が未実装となっています。

**重要**: URLパス（`/online/games`）以外では既存の命名規約をそのまま使用します。コンポーネント名、関数名、型名は既存実装と同じ名前を使用してください。

移行にあたっては既存のIndexedDBベースの実装に影響しない形で、完全に独立させて実装してください。

## 実装状況

### ✅ 実装済み

**基本機能**:

- ゲーム作成機能（CloudCreateGameModal）
- ゲーム一覧表示（CloudGameList）
- 基本的なAPI構造
- 認証基盤

**プレイヤー管理機能**:

- オンラインプレイヤー一覧・作成・編集・削除機能 (`/online/players`)
- ゲーム内プレイヤー設定機能 (`PlayersConfig`)
- プレイヤーの追加・削除・編集
- 初期スコア・正解数・誤答数の設定
- 既存プレイヤーからの選択機能
- 既存ゲームからのプレイヤー選択機能

**クイズ管理機能**:

- オンラインクイズ一覧・作成・編集・削除機能 (`/online/quizes`)
- ゲーム内クイズセット選択機能 (`SelectQuizset`)

**ゲーム設定機能**:

- ルール設定機能 (`RuleSettings`)
- 各ゲーム形式別の設定項目 (AQL、その他形式)
- 動的な設定UIの生成
- バリデーション機能
- デフォルト値の設定

**ボード表示機能**:

- 完全なボード表示システム (`/online/games/[game_id]/board`)
- リアルタイムスコア表示
- プレイヤー操作ボタン
- ゲームログ表示
- 勝利判定とモーダル表示
- 元に戻す/やり直し機能
- プリファレンス機能（設定パネル）

**その他設定機能**:

- ゲーム名の変更
- ゲームのコピー機能
- ゲームの削除機能
- データエクスポート機能

### ❌ 未実装（残作業）

#### 1. Discord Webhook設定（中優先度）

**現状**: 未実装  
**必要な実装**:

- Discord Webhook URLの設定
- ゲーム終了時の自動通知機能

## 実装順序

1. ~~**フェーズ1**: プレイヤー設定機能~~ ✅ **完了**
2. ~~**フェーズ2**: 形式設定機能~~ ✅ **完了**
3. ~~**フェーズ3**: ボード表示機能~~ ✅ **完了**
4. ~~**フェーズ4**: その他設定機能~~ ✅ **完了** (Discord Webhook除く)
5. **フェーズ5**: Discord Webhook機能 (残作業)
6. **フェーズ6**: 認証・権限管理強化
7. **フェーズ7**: データ同期機能（リアルタイム）

## 技術的考慮事項

### データベース設計

- 既存のDrizzleスキーマを活用
- 必要に応じて新しいテーブルを追加
- マイグレーション戦略の検討

### APIエンドポイント

- RESTful設計の維持
- Hono frameworkの活用
- バリデーション強化

### UI/UX

- 既存のMantineコンポーネント活用
- CSS Modulesによるスタイリング
- レスポンシブ対応

### 型安全性

- TypeScript strict mode
- Zodによるバリデーション
- 適切な型定義の維持

### 命名規約

- URLパス: `/online/games` (既存の`/games`と分離)
- コンポーネント名: `GameConfig`, `PlayerList` など（既存と同じ）
- 関数名: `getGame`, `updateGamePlayer` など（既存と同じ）
- ファイル名: `GameConfig.tsx`, `PlayersConfig.tsx` など（既存と同じ）
- API Routes: `/api/games/*` (IndexedDB版は使用しないため競合しない)
